<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ランクポイントシミュレーター</title>
    <!-- Tailwind CSS (デザイン用) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM (動作ロジック用) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (ブラウザでReactを動かすための変換ツール) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif; }
    </style>
</head>
<body class="bg-gray-50 text-slate-800">

    <!-- ここにReactアプリが描画されます -->
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // アイコンコンポーネント (Lucide icons の代用としてインラインSVGを使用)
        const CalculatorIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/>
            </svg>
        );

        const RotateCcwIcon = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>
            </svg>
        );

        // メインアプリケーション
        function App() {
            // D4〜D8の入力値を管理するステート
            const [inputs, setInputs] = useState({
                d4: 0,
                d5: 0,
                d6: 0,
                d7: 0,
                d8: 0,
            });

            // 入力値が変更されたときの処理
            const handleChange = (key, value) => {
                const numValue = parseFloat(value);
                setInputs(prev => ({
                    ...prev,
                    [key]: isNaN(numValue) ? 0 : numValue
                }));
            };

            // リセット処理
            const handleReset = () => {
                setInputs({ d4: 0, d5: 0, d6: 0, d7: 0, d8: 0 });
            };

            // 計算ロジック
            const results = useMemo(() => {
                const { d4, d5, d6, d7, d8 } = inputs;

                // ② 累計獲得pt: 単純合計
                const ruikeiKakutokuPt = d4 + d5 + d6 + d7 + d8;

                // ③ 割合ポイント: 重みづけ合計
                const wariaiPoint = 
                    (d4 * (35 / 25)) + 
                    (d5 * (22 / 25)) + 
                    (d6 * (15 / 25)) + 
                    (d7 * (7 / 25)) + 
                    (d8 * (1 / 25));

                // ④ 累計乗数: 初期値0.05, 2000ptごとに0.05加算, 最小0.05, 最大20
                const calcJosu = (Math.floor(ruikeiKakutokuPt / 2000) * 0.05) + 0.05;
                const ruikeiJosu = Math.min(20, Math.max(0.05, calcJosu));

                // ⑤ ランクポイント
                const rankPoint = wariaiPoint * ruikeiJosu;

                return {
                    ruikeiKakutokuPt,
                    wariaiPoint,
                    ruikeiJosu,
                    rankPoint
                };
            }, [inputs]);

            // 色定義
            const cellColors = {
                d4: '#F2CEEF',
                d5: '#8AB8E6',
                d6: '#FF8181',
                d7: '#FFD03B',
                d8: '#8ED973',
            };

            return (
                <div className="min-h-screen bg-gray-50 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
                        
                        {/* Header */}
                        <div className="bg-slate-800 text-white p-6 flex items-center gap-3">
                            <CalculatorIcon className="w-8 h-8 text-blue-400" />
                            <div>
                                <h1 className="text-2xl font-bold">ランクポイントシミュレーター</h1>
                                <p className="text-slate-400 text-sm">数値を入力して各ポイントを算出します</p>
                            </div>
                        </div>

                        <div className="p-6 md:p-8 grid md:grid-cols-2 gap-8">
                            
                            {/* ① 入力エリア */}
                            <div className="space-y-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-xl font-semibold border-l-4 border-blue-500 pl-3">入力エリア</h2>
                                    <button 
                                        onClick={handleReset}
                                        className="flex items-center gap-1 text-sm text-gray-500 hover:text-red-500 transition-colors"
                                    >
                                        <RotateCcwIcon className="w-4 h-4" />
                                        リセット
                                    </button>
                                </div>

                                <div className="space-y-4">
                                    <InputRow id="d4" label="ダイアモンド" iconChar="D" color={cellColors.d4} value={inputs.d4} onChange={handleChange} />
                                    <InputRow id="d5" label="サファイア" iconChar="S" color={cellColors.d5} value={inputs.d5} onChange={handleChange} />
                                    <InputRow id="d6" label="ルビー" iconChar="R" color={cellColors.d6} value={inputs.d6} onChange={handleChange} />
                                    <InputRow id="d7" label="トパーズ" iconChar="T" color={cellColors.d7} value={inputs.d7} onChange={handleChange} />
                                    <InputRow id="d8" label="エメラルド" iconChar="E" color={cellColors.d8} value={inputs.d8} onChange={handleChange} />
                                </div>
                                
                                <p className="text-xs text-gray-400 mt-4">
                                    ※各項目に任意の数値を入力してください。
                                </p>
                            </div>

                            {/* 結果エリア */}
                            <div className="bg-gray-50 rounded-xl p-6 border border-gray-200">
                                <h2 className="text-xl font-semibold border-l-4 border-green-500 pl-3 mb-6">計算結果</h2>

                                <div className="space-y-6">
                                    {/* ② 累計獲得pt */}
                                    <ResultCard 
                                        title="累計獲得pt" 
                                        value={results.ruikeiKakutokuPt.toLocaleString()} 
                                        subValue="単純合計値"
                                        colorClass="text-gray-700"
                                    />

                                    {/* ③ 割合ポイント */}
                                    <ResultCard 
                                        title="割合ポイント" 
                                        value={results.wariaiPoint.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })} 
                                        subValue="重み付け合計"
                                        colorClass="text-blue-600"
                                    />

                                    {/* ④ 累計乗数 */}
                                    <ResultCard 
                                        title="累計乗数" 
                                        value={results.ruikeiJosu.toFixed(2)} 
                                        subValue="倍率 (Max 20.00)"
                                        colorClass="text-purple-600"
                                    />

                                    {/* ⑤ ランクポイント */}
                                    <div className="mt-8 pt-6 border-t border-gray-300">
                                        <p className="text-sm text-gray-500 font-bold mb-1">ランクポイント (最終結果)</p>
                                        <div className="text-4xl font-black text-gray-800 tracking-tight">
                                            {results.rankPoint.toLocaleString(undefined, { minimumFractionDigits: 1, maximumFractionDigits: 1 })}
                                            <span className="text-lg font-normal text-gray-500 ml-2">pt</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // サブコンポーネント: 入力行
        function InputRow({ id, label, iconChar, color, value, onChange }) {
            return (
                <div className="flex items-center gap-4">
                    <div className="w-4 h-full rounded-l-md self-stretch shadow-sm" style={{ backgroundColor: color }}></div>
                    <div className="flex-1">
                        <label htmlFor={id} className="block text-xs font-bold text-gray-500 mb-1 uppercase tracking-wider">
                            {label}
                        </label>
                        <div className="relative flex items-center">
                            <div 
                                className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold mr-3 shadow-sm border border-black/10 text-gray-700"
                                style={{ backgroundColor: color }}
                            >
                                {iconChar}
                            </div>
                            <input
                                type="number"
                                id={id}
                                value={value === 0 ? '' : value}
                                placeholder="0"
                                onChange={(e) => onChange(id, e.target.value)}
                                className="w-full bg-white border border-gray-300 text-gray-900 text-lg rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2.5 transition-all shadow-sm"
                            />
                        </div>
                    </div>
                </div>
            );
        }

        // サブコンポーネント: 結果カード
        function ResultCard({ title, value, subValue, colorClass }) {
            return (
                <div className="bg-white p-4 rounded-lg shadow-sm border border-gray-100 flex justify-between items-center">
                    <div>
                        <p className="text-sm font-medium text-gray-500">{title}</p>
                        <p className="text-xs text-gray-400 mt-1">{subValue}</p>
                    </div>
                    <div className={`text-2xl font-bold ${colorClass}`}>
                        {value}
                    </div>
                </div>
            );
        }

        // アプリケーションの描画
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>